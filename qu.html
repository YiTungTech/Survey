<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="js/js.cookie.js"></script>
    <!-- json序列化 -->
    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script> -->
    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.js"></script> -->
    <script type="text/javascript">
    var COOKIE_KEY_LAST_RECORD_URL = 'LAST_RECORD';

    $(function() {

        init();

        //預設勾選第一個radio button
        $('fieldset').each(function(index, element) {
            $(this).find('input').eq(1).attr('checked', true);
        });

        //檢查是否有上次檢驗報告紀錄
        var lastRecordUrl = Cookies.get(COOKIE_KEY_LAST_RECORD_URL);
        if (typeof lastRecordUrl != 'undefined') {
            //cookie有值
            $('#btn_lastRecordUrl').show();

            $('#btn_lastRecordUrl').click(function() {
                goNextPage(lastRecordUrl);
                return false; //false : 結束button後續動作
            });
        } else {
            //cookie沒有值
            $('#btn_lastRecordUrl').hide();
        }

        //設定上下頁按鈕
        var currentPage = 0;
        $("#btn_pre").click(function() {
            gotoNextAction(--currentPage);
        });

        $("#btn_next").click(function() {
            gotoNextAction(++currentPage);
        });
        //問卷上/下頁 or 結束問卷
        function gotoNextAction(page) {

            //如果是最後一頁，跳到檢驗報告頁
            if (page >= $(".page").length) {
                onClickSubmit();
            } else {
                //顯示上/下一頁
                $(".page").hide();
                $('.page').eq(page).show();
            }
        }

        //點擊問卷送出
        function onClickSubmit() {

            var url = 'result.html?';
            //取得有勾選的radiobutton id + 值，並賦予到jsonObject身上。
            $('input:checked').each(function(index, element) { //取得Radio button 有check的。
                var qid = $(this).attr('name'); //取得google form id
                var value = $(this).attr('value'); //取得radio button value

                url += qid + '=' + value;
                if (index != $('input:checked').length - 1) {
                    url += '&';
                }

            });

            //將參數記錄至cookie，下次使用
            Cookies.set(COOKIE_KEY_LAST_RECORD_URL, url, { expires: 365 });

            //導網址
            goNextPage(url);

        }
    });

    function goNextPage(pageUrl) {
        console.log('goNextPage');
        //解除綁定
        $(window).unbind('beforeunload');

        //導網址
        window.location.href = pageUrl;
    }


    function init() {
        console.log('init()');
        $(window).bind('beforeunload', function(e) {

            console.log('beforeunload');
            return '資料尚未存檔，確定是否要離開？'; //Chrome v51 (2016/04) 取消自訂wording
        });
    }
    </script>
</head>

<body>
    <div class="page" id="page1">
        <div id="target"></div>
        <h1>這裡是Page1</h1>
        <h2>Radio Group</h2>
        <fieldset id="fieldset-1">
            <legend>1. 常待在密閉、通風不良空間嗎？</legend>
            <label for="radio-1">1</label>
            <input type="radio" name="1848259859" id="1848259859-1" value="1">
            <label for="radio-2">2</label>
            <input type="radio" name="1848259859" id="1848259859-2" value="2">
            <label for="radio-3">3</label>
            <input type="radio" name="1848259859" id="1848259859-3" value="3">
            <label for="radio-4">4</label>
            <input type="radio" name="1848259859" id="1848259859-4" value="4">
            <label for="radio-5">5</label>
            <input type="radio" name="1848259859" id="1848259859-5" value="5">
        </fieldset>
        <fieldset>
            <legend>2. 常感到空氣污濁嗎 (如空污、二手煙、廚房油煙)?</legend>
            <label for="radio-1">1</label>
            <input type="radio" name="1221090849" id="1221090849-1" value="1">
            <label for="radio-2">2</label>
            <input type="radio" name="1221090849" id="1221090849-2" value="2">
            <label for="radio-3">3</label>
            <input type="radio" name="1221090849" id="1221090849-3" value="3">
            <label for="radio-4">4</label>
            <input type="radio" name="1221090849" id="1221090849-4" value="4">
            <label for="radio-5">5</label>
            <input type="radio" name="1221090849" id="1221090849-5" value="5">
        </fieldset>
        <fieldset>
            <legend>3. 經常鼻塞或氣喘嗎？</legend>
            <label for="radio-1">1</label>
            <input type="radio" name="299261106" id="299261106-1" value="1">
            <label for="radio-2">2</label>
            <input type="radio" name="299261106" id="299261106-2" value="2">
            <label for="radio-3">3</label>
            <input type="radio" name="299261106" id="299261106-3" value="3">
            <label for="radio-4">4</label>
            <input type="radio" name="299261106" id="299261106-4" value="4">
            <label for="radio-5">5</label>
            <input type="radio" name="299261106" id="299261106-5" value="5">
        </fieldset>
    </div>
    <div class="page" id="page2">
        <h1>這裡是Page2</h1>
        <h2>Radio Group</h2>
        <fieldset>
            <legend>1. 經常連續超過12小時以上的情緒緊繃？</legend>
            <label for="radio-1">1</label>
            <input type="radio" name="842487678" id="842487678-1" value="1">
            <label for="radio-2">2</label>
            <input type="radio" name="842487678" id="842487678-2" value="2">
            <label for="radio-3">3</label>
            <input type="radio" name="842487678" id="842487678-3" value="3">
            <label for="radio-4">4</label>
            <input type="radio" name="842487678" id="842487678-4" value="4">
            <label for="radio-5">5</label>
            <input type="radio" name="842487678" id="842487678-5" value="5">
        </fieldset>
    </div>
    <script type="text/javascript">
    $('#page2').hide();
    </script>
    <button id="btn_pre">上一頁</button>
    <button id="btn_next">下一頁</button>
    <button id="btn_lastRecordUrl">查看上次檢驗報告</button>
</body>

</html>